{
    "sourceFile": "auth/create-customer.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1643920424568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1643920424568,
            "name": "Commit-0",
            "content": "<?php \n    // just simple auth\n    require '../config/index.php';\n    $config = new config();\n    $con = $config->database();\n\n    include '../security.php';\n    if(!$auth){\n        die('');\n        return '';\n    }\n\n    // extract datas\n    try {\n        $plain_data = $_REQUEST['data'];\n        $data = json_decode($plain_data);\n        // print($plain_data);\n        // print_r($data);\n        // die('');\n\n        if( !isset($data->email) && !isset($data->username) && !isset($data->password) ){\n            print(json_encode(\n                [\n                    'status' => false,\n                    'message' => 'please ensure to send all perimeter, email, username, password'\n                ]\n            ));\n        }\n\n        $email = ($data->email);\n        $username = ($data->username);\n        $password = ($data->password);\n\n        // check if user already exist\n        $num = mysqli_num_rows(mysqli_query($con, \"SELECT * FROM custom_holder_registration WHERE email = '$email' OR username = '$username' \"));\n        if( $num != 0){\n            // user already exist\n            print(json_encode(\n                [\n                    'status' => false,\n                    'message' => 'user already exist'\n                ]\n            ));\n            die('');\n            return '';\n        }else{\n            // insert into dB\n            $sql = \"INSERT INTO custom_holder_registration(email, username, password, data) VALUES('$email', '$username', '$password', '$plain_data')\";\n            if(  mysqli_query($con, $sql) ){\n                sendMail($email);\n                print(json_encode(\n                    [\n                        'status' => true,\n                        'message' => 'Activation Link Created Successfully'\n                    ]\n                ));\n            }else{\n                // error inputting into dB\n                print(json_encode(\n                    [\n                        'status' => false,\n                        'message' => 'try again later #2'\n                    ]\n                ));\n                die('');\n                return '';\n            }\n        }\n    } catch (\\Throwable $th) {\n        print(json_encode(\n            [\n                'status' => false,\n                'message' => 'an error occurred'\n            ]\n        ));\n    }\n    \n    function sendMail($email){\n        // echo mysqli_num_rows(mysqli_query($con, \"SELECT * FROM wpdc_users\"));\n        $to = $email;\n        $subject = \"Account Activation Link\";\n        $link = $_SERVER['SERVER_NAME'].\"/v1/verify?l=\".base64_encode($email);\n\n        $message = \"\n        <html>\n        <head>\n        <title>$subject</title>\n        </head>\n        <body>\n            <p>Click the link below to activate your account!</p>\n    \n            <a href='$link'>Click Here</a>\n        </body>\n        </html>\n        \";\n\n        // Always set content-type when sending HTML email\n        $headers = \"MIME-Version: 1.0\" . \"\\r\\n\";\n        $headers .= \"Content-type:text/html;charset=UTF-8\" . \"\\r\\n\";\n\n        // More headers\n        $headers .= 'From: <no-reply@lumigrowgroup.com>' . \"\\r\\n\";\n\n        if(!mail($to,$subject,$message,$headers)){\n            // echo 'not sent';\n            return false;\n        }\n        return true;\n    }\n    \n?>"
        }
    ]
}